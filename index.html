<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storezee - Design</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- React and ReactDOM for UI rendering -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX transpilation in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Applying the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple scrollbar styling */
        ::-webkit-scrollbar {
            width: 5px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-900">
    <!-- The root element where the React app will be mounted -->
    <div id="root"></div>

    <!-- The React application code, transpiled by Babel -->
    <script type="text/babel">
        // --- INLINE SVG ICONS (Replaces lucide-react dependency) ---
        const Icon = ({ children, size = 24, strokeWidth = 2, ...props }) => (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width={size}
                height={size}
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                strokeWidth={strokeWidth}
                strokeLinecap="round"
                strokeLinejoin="round"
                {...props}
            >
                {children}
            </svg>
        );

        const icons = {
            MapPin: (props) => <Icon {...props}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></Icon>,
            Star: (props) => <Icon {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></Icon>,
            Search: (props) => <Icon {...props}><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /></Icon>,
            X: (props) => <Icon {...props}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></Icon>,
            ChevronLeft: (props) => <Icon {...props}><polyline points="15 18 9 12 15 6" /></Icon>,
            Home: (props) => <Icon {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></Icon>,
            User: (props) => <Icon {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></Icon>,
            Bell: (props) => <Icon {...props}><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" /><path d="M13.73 21a2 2 0 0 1-3.46 0" /></Icon>,
            LifeBuoy: (props) => <Icon {...props}><circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="4" /><line x1="4.93" y1="4.93" x2="9.17" y2="9.17" /><line x1="14.83" y1="14.83" x2="19.07" y2="19.07" /><line x1="4.93" y1="19.07" x2="9.17" y2="14.83" /><line x1="14.83" y1="9.17" x2="19.07" y2="4.93" /></Icon>,
            CreditCard: (props) => <Icon {...props}><rect x="2" y="5" width="20" height="14" rx="2" /><line x1="2" y1="10" x2="22" y2="10" /></Icon>,
            CheckCircle: (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></Icon>,
            ArrowRight: (props) => <Icon {...props}><line x1="5" y1="12" x2="19" y2="12" /><polyline points="12 5 19 12 12 19" /></Icon>,
            Package: (props) => <Icon {...props}><path d="M16.5 9.4a4.5 4.5 0 1 1-9 0" /><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" /><polyline points="3.27 6.96 12 12.01 20.73 6.96" /><line x1="12" y1="22.08" x2="12" y2="12" /></Icon>,
            Truck: (props) => <Icon {...props}><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2" /><path d="M15 18H9" /><path d="M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14" /><circle cx="6" cy="18" r="2" /><circle cx="18" cy="18" r="2" /></Icon>,
            Archive: (props) => <Icon {...props}><rect x="2" y="3" width="20" height="5" rx="1" /><path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8" /><path d="M10 12h4" /></Icon>,
            Sparkles: (props) => <Icon {...props}><path d="m12 3-1.9 5.8-5.8 1.9 5.8 1.9L12 18l1.9-5.8 5.8-1.9-5.8-1.9L12 3z" /><path d="M5 3v4" /><path d="M19 17v4" /><path d="M3 5h4" /><path d="M17 19h4" /></Icon>,
            Loader2: (props) => <Icon {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56" /></Icon>,
            Bot: (props) => <Icon {...props}><path d="M12 8V4H8" /><rect x="4" y="8" width="16" height="12" rx="2" /><path d="M2 14h2" /><path d="M20 14h2" /><path d="M15 13v2" /><path d="M9 13v2" /></Icon>,
            Wallet: (props) => <Icon {...props}><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4" /><path d="M3 5v14a2 2 0 0 0 2 2h16v-5" /><path d="M18 12a2 2 0 0 0 0 4h4v-4Z" /></Icon>,
            History: (props) => <Icon {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /><path d="M12 7v5l4 2" /></Icon>,
            Gift: (props) => <Icon {...props}><rect x="3" y="8" width="18" height="4" rx="1" /><path d="M12 8v13" /><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7" /><path d="M7.5 8a2.5 2.5 0 0 1 0-5A2.5 2.5 0 0 1 12 5.5V8" /><path d="M16.5 8a2.5 2.5 0 0 0 0-5A2.5 2.5 0 0 0 12 5.5V8" /></Icon>,
            PlusCircle: (props) => <Icon {...props}><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="16" /><line x1="8" y1="12" x2="16" y2="12" /></Icon>,
            Building: (props) => <Icon {...props}><rect x="4" y="2" width="16" height="20" rx="2" /><path d="M9 22v-4h6v4" /><path d="M8 6h.01" /><path d="M16 6h.01" /><path d="M12 6h.01" /><path d="M12 10h.01" /><path d="M12 14h.01" /><path d="M16 10h.01" /><path d="M16 14h.01" /><path d="M8 10h.01" /><path d="M8 14h.01" /></Icon>,
            Coffee: (props) => <Icon {...props}><path d="M17 8h1a4 4 0 1 1 0 8h-1" /><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z" /><line x1="6" y1="2" x2="6" y2="4" /><line x1="10" y1="2" x2="10" y2="4" /><line x1="14" y1="2" x2="14" y2="4" /></Icon>,
            Camera: (props) => <Icon {...props}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z" /><circle cx="12" cy="13" r="3" /></Icon>,
            Repeat: (props) => <Icon {...props}><path d="m17 2 4 4-4 4" /><path d="M3 11v-1a4 4 0 0 1 4-4h14" /><path d="m7 22-4-4 4-4" /><path d="M21 13v1a4 4 0 0 1-4 4H3" /></Icon>,
            ChevronRight: (props) => <Icon {...props}><polyline points="9 18 15 12 9 6" /></Icon>,
        };
        
        const { useState, useEffect, cloneElement } = React;

        // --- MOCK DATA ---
        const mockLocations = [
          { id: 1, name: "Connaught Place Secure Storage", address: "A-Block, Connaught Place, New Delhi", distance: "0.5 km", rating: 4.8, price: 75, photos: ['https://placehold.co/600x400/a7d8de/ffffff?text=Store+Front', 'https://placehold.co/600x400/e2e8f0/334155?text=Interior'], availability: "Open 24 hours", reviews: ["Perfect location for exploring CP!", "Staff was very courteous and the process was smooth.", "A bit expensive but totally worth the convenience."] },
          { id: 2, name: "Khan Market KeepSafe", address: "Shop 15, Khan Market, New Delhi", distance: "1.2 km", rating: 4.9, price: 80, photos: ['https://placehold.co/600x400/a7d8de/ffffff?text=Shop+View', 'https://placehold.co/600x400/e2e8f0/334155?text=Storage+Area'], availability: "8am - 10pm", reviews: ["Super clean and secure. Left my laptop without any worries.", "The owner is very friendly.", "Best rates for such a prime location."]},
          { id: 3, name: "Paharganj Traveler's Hub", address: "Main Bazaar, Paharganj, New Delhi", distance: "2.1 km", rating: 4.5, price: 50, photos: ['https://placehold.co/600x400/a7d8de/ffffff?text=Hostel+Storage', 'https://placehold.co/600x400/e2e8f0/334155?text=Secure+Lockers'], availability: "24/7 for guests", reviews: ["Great for backpackers.", "A bit chaotic to find but the service is good.", "Very affordable."]},
        ];

        const mockBookings = [
            { id: 'BD78901', location: "Connaught Place Secure Storage", date: "2025-07-20", status: "Completed", price: 300 },
            { id: 'BD65432', location: "Khan Market KeepSafe", date: "2025-07-15", status: "Completed", price: 240 },
            { id: 'BD11223', location: "Paharganj Traveler's Hub", date: "2025-06-30", status: "Cancelled", price: 100 },
        ];

        const mockWalletTransactions = [
            { id: 1, type: "Added", amount: 500, date: "2025-07-22", method: "UPI" },
            { id: 2, type: "Paid", amount: -300, date: "2025-07-20", details: "Booking BD78901" },
            { id: 3, type: "Cashback", amount: 50, date: "2025-07-20", details: "First Booking Offer" },
            { id: 4, type: "Paid", amount: -240, date: "2025-07-15", details: "Booking BD65432" },
        ];

        const mockNotifications = [
            { id: 1, icon: <icons.Gift className="text-orange-500" />, title: "Weekend Offer!", message: "Get 20% off on bookings this weekend. Use code WEEKEND20.", time: "1h ago" },
            { id: 2, icon: <icons.CheckCircle className="text-green-500" />, title: "Booking Confirmed", message: "Your booking BD78901 at Connaught Place is confirmed.", time: "3d ago" },
            { id: 3, icon: <icons.Truck className="text-blue-500" />, title: "Luggage Stored", message: "Your luggage for booking BD78901 has been securely stored.", time: "3d ago" },
        ];

        // --- MAIN APP COMPONENT ---
        function App() {
          const [page, setPage] = useState('onboarding'); // onboarding, login, home, details, booking, tracking, wallet, history, profile, notifications
          const [selectedLocation, setSelectedLocation] = useState(null);
          const [modal, setModal] = useState(null); // 'itinerary', 'explore', 'rate'
          const [apiResult, setApiResult] = useState(null);
          const [isApiLoading, setIsApiLoading] = useState(false);
          const [walletBalance, setWalletBalance] = useState(250);

          const navigateTo = (pageName) => {
            setPage(pageName);
            window.scrollTo(0, 0);
          };
          
          const handleSelectLocation = (location) => {
            setSelectedLocation(location);
            navigateTo('details');
          };

          const handleApiCall = async (type, context) => {
            setIsApiLoading(true);
            setApiResult(null);
            let prompt;
            let schema;

            if (type === 'itinerary') {
                setModal('itinerary');
                prompt = `I am a tourist in New Delhi, India. My plan for today is: "${context.plan}". The current time is around 2:30 PM. Create a simple, timed itinerary for the rest of my day. Also, suggest the most convenient luggage storage location from this list to start my plan: ${JSON.stringify(mockLocations.map(l => ({id: l.id, name: l.name, address: l.address})))}.`;
                schema = { type: "OBJECT", properties: { "suggested_storage_id": { "type": "NUMBER" }, "itinerary": { "type": "ARRAY", "items": { "type": "OBJECT", "properties": { "time": { "type": "STRING" }, "activity": { "type": "STRING" }, "description": { "type": "STRING" } }, "required": ["time", "activity"] } } }, required: ["suggested_storage_id", "itinerary"] };
            } else if (type === 'summarize') {
                prompt = `Summarize the following user reviews for a luggage storage location in New Delhi into 2-3 bullet points covering the main pros and cons. Reviews: "${context.reviews.join('", "')}"`;
            } else if (type === 'explore') {
                setModal('explore');
                prompt = `I am at a luggage storage location at "${context.address}". Suggest 3-4 interesting things to do nearby (within a 1-2 km radius). For each suggestion, provide a category (e.g., Cafe, Landmark, Shopping, Activity), a name, and a brief 1-sentence description.`;
                schema = { type: "ARRAY", "items": { "type": "OBJECT", "properties": { "category": {"type": "STRING"}, "name": {"type": "STRING"}, "description": {"type": "STRING"} }, "required": ["category", "name", "description"] } };
            }

            try {
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { 
                    contents: chatHistory,
                    ...(schema && { generationConfig: { responseMimeType: "application/json", responseSchema: schema } })
                };
                const apiKey = ""; // Handled by environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`API error: ${response.statusText}`);
                const result = await response.json();
                
                if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                    const textResult = result.candidates[0].content.parts[0].text;
                    setApiResult(schema ? JSON.parse(textResult) : textResult);
                } else {
                    throw new Error("Invalid API response structure.");
                }
            } catch (error) {
                console.error(`Error with Gemini API (${type}):`, error);
                setApiResult({ error: `Could not generate a response. Please try again. ${error.message}` });
            } finally {
                setIsApiLoading(false);
            }
          };

          const renderPage = () => {
            switch (page) {
              case 'onboarding': return <OnboardingScreen onGetStarted={() => navigateTo('login')} />;
              case 'login': return <LoginScreen onLogin={() => navigateTo('home')} />;
              case 'home': return <HomeScreen onSelectLocation={handleSelectLocation} onGenerateItinerary={(plan) => handleApiCall('itinerary', { plan })} isLoading={isApiLoading && modal === 'itinerary'} />;
              case 'details': return <DetailsScreen location={selectedLocation} onBack={() => navigateTo('home')} onBookNow={() => navigateTo('booking')} onSummarizeReviews={(reviews) => handleApiCall('summarize', { reviews })} onExploreNearby={(address) => handleApiCall('explore', { address })} summaryResult={apiResult} isSummaryLoading={isApiLoading && !modal} />;
              case 'booking': return <BookingScreen location={selectedLocation} onBack={() => navigateTo('details')} onConfirm={() => { setModal('rate'); navigateTo('tracking'); }} walletBalance={walletBalance} setWalletBalance={setWalletBalance} />;
              case 'tracking': return <TrackingScreen />;
              case 'wallet': return <WalletScreen balance={walletBalance} transactions={mockWalletTransactions} />;
              case 'history': return <HistoryScreen bookings={mockBookings} />;
              case 'profile': return <ProfileScreen />;
              case 'notifications': return <NotificationsScreen notifications={mockNotifications} />;
              default: return <HomeScreen onSelectLocation={handleSelectLocation} onGenerateItinerary={(plan) => handleApiCall('itinerary', { plan })} />;
            }
          };

          const renderModal = () => {
            switch (modal) {
                case 'itinerary': return <ItineraryModal result={apiResult} isLoading={isApiLoading} onClose={() => setModal(null)} onSelectLocation={handleSelectLocation} />;
                case 'explore': return <ExploreNearbyModal result={apiResult} isLoading={isApiLoading} onClose={() => setModal(null)} />;
                case 'rate': return <RateExperienceModal bookingId="BD78901" onClose={() => setModal(null)} />;
                default: return null;
            }
          };

          return (
            <div className="bg-gray-900 min-h-screen font-sans flex flex-col items-center">
              <div className="w-full max-w-sm bg-gray-50 shadow-2xl flex flex-col" style={{minHeight: '100vh'}}>
                <div className="flex-grow">
                  {renderPage()}
                </div>
                {['home', 'history', 'wallet', 'profile'].includes(page) && <BottomNavBar activePage={page} navigateTo={navigateTo} />}
                {renderModal()}
              </div>
            </div>
          );
        }

        // --- SCREENS ---
        const OnboardingScreen = ({ onGetStarted }) => {
          const [slide, setSlide] = useState(0);
          const slides = [
            { icon: "🌍", title: "Travel Freely, Live Fully", description: "Drop your bags and explore the city hands-free. From airport delays to early check-outs." },
            { icon: "✨", title: "Your AI Travel Assistant", description: "Plan your day with our AI itinerary generator and discover hidden gems around your storage spot." },
            { icon: "🔒", title: "Tracked, Vetted & Secure", description: "Enjoy peace of mind with live tracking and our network of trusted, verified locations." },
          ];

          return (
            <div className="flex flex-col h-full items-center justify-between p-8 text-center bg-blue-50">
              <div className="absolute top-6 right-6">
                <button onClick={onGetStarted} className="text-gray-500 font-medium py-2 px-4 rounded-lg text-sm">Skip</button>
              </div>
              <div className="mt-24">
                <div className="text-6xl mb-8 transition-transform duration-300 transform hover:scale-110">{slides[slide].icon}</div>
                <h1 className="text-2xl font-bold text-gray-800 mb-4">{slides[slide].title}</h1>
                <p className="text-gray-600">{slides[slide].description}</p>
              </div>
              <div className="w-full mb-4">
                <div className="flex justify-center items-center space-x-2 mb-8">
                  {slides.map((_, i) => ( <div key={i} className={`w-2.5 h-2.5 rounded-full transition-all duration-300 ${i === slide ? 'bg-teal-500 scale-125' : 'bg-gray-300'}`}></div> ))}
                </div>
                <button onClick={slide === slides.length - 1 ? onGetStarted : () => setSlide(s => s + 1)} className="w-full bg-teal-500 text-white font-bold py-3.5 px-4 rounded-full shadow-lg hover:bg-teal-600 transition-all duration-300 transform hover:scale-105 flex items-center justify-center">
                  {slide === slides.length - 1 ? "Get Started" : "Next"} <icons.ArrowRight size={18} className={`ml-2 transition-transform ${slide !== slides.length - 1 ? '' : 'hidden'}`} />
                </button>
              </div>
            </div>
          );
        };

        const LoginScreen = ({ onLogin }) => (
            <div className="p-8 flex flex-col justify-center h-full bg-white">
              <div className="text-center mb-12">
                <h1 className="text-4xl font-bold text-teal-600">BagDrop</h1>
                <p className="text-gray-500 mt-2">Secure luggage storage, anywhere.</p>
              </div>
              <div className="space-y-4">
                <div className="relative">
                  <span className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">+91</span>
                  <input type="tel" placeholder="Enter Mobile Number" className="w-full pl-14 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-teal-200 focus:border-teal-400 outline-none transition" />
                </div>
                <button onClick={onLogin} className="w-full bg-teal-500 text-white font-bold py-3 px-4 rounded-xl shadow-md hover:bg-teal-600 transition-transform transform hover:scale-105">Continue</button>
              </div>
              <div className="my-8 flex items-center"><div className="flex-grow border-t border-gray-200"></div><span className="px-4 text-gray-400 text-sm">OR</span><div className="flex-grow border-t border-gray-200"></div></div>
              <button onClick={onLogin} className="w-full bg-white border border-gray-300 text-gray-700 font-semibold py-3 px-4 rounded-xl flex items-center justify-center shadow-sm hover:bg-gray-100 transition">
                <img src="https://www.google.com/favicon.ico" alt="Google" className="w-5 h-5 mr-3" />Sign in with Google
              </button>
            </div>
        );

        const HomeScreen = ({ onSelectLocation, onGenerateItinerary, isLoading }) => {
          const [plan, setPlan] = useState('');
          return (
            <div className="flex flex-col h-full">
              <div className="p-4 bg-white sticky top-0 z-10">
                <div className="flex items-center justify-between mb-4">
                  <div>
                    <p className="text-xs text-gray-500">Your Location</p>
                    <h2 className="font-bold text-gray-800 flex items-center"><icons.MapPin size={16} className="mr-1 text-orange-500" /> New Delhi, IND</h2>
                  </div>
                  <button className="relative">
                    <icons.Bell size={24} className="text-gray-600" />
                    <span className="absolute -top-1 -right-1 w-2.5 h-2.5 bg-orange-500 rounded-full border-2 border-white"></span>
                  </button>
                </div>
                <div className="relative">
                  <icons.Search size={20} className="absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400" />
                  <input type="text" placeholder="Find storage near an address or landmark..." className="w-full bg-gray-100 border border-transparent rounded-xl pl-11 pr-4 py-3.5 focus:ring-2 focus:ring-teal-200 focus:bg-white outline-none transition" />
                </div>
              </div>
              <div className="flex-grow overflow-y-auto p-4 space-y-6">
                <div className="bg-teal-50 border-2 border-teal-200 border-dashed rounded-xl p-4">
                    <div className="flex items-center mb-2"><icons.Sparkles className="text-teal-500 mr-2" size={20}/><h3 className="font-bold text-gray-800 text-lg">AI Trip Planner</h3></div>
                    <p className="text-sm text-gray-600 mb-3">Tell us your plans, we'll craft an itinerary and find the best spot for your bags.</p>
                    <textarea value={plan} onChange={(e) => setPlan(e.target.value)} placeholder="e.g., Visit Red Fort, then shopping at Chandni Chowk" className="w-full bg-white border border-gray-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-teal-200 outline-none transition" rows="2"></textarea>
                    <button onClick={() => onGenerateItinerary(plan)} disabled={isLoading || !plan} className="w-full mt-3 bg-teal-500 text-white font-bold py-2.5 px-4 rounded-lg shadow-md hover:bg-teal-600 transition-all disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center">
                        {isLoading ? <icons.Loader2 className="animate-spin" /> : <span className="flex items-center">✨ Generate Itinerary</span>}
                    </button>
                </div>
                <div>
                    <h3 className="font-bold text-gray-800 text-lg mb-2">Nearby Storage Points</h3>
                    <div className="space-y-4">
                        {mockLocations.map(loc => ( <LocationCard key={loc.id} location={loc} onSelect={() => onSelectLocation(loc)} /> ))}
                    </div>
                </div>
              </div>
            </div>
          );
        };

        const DetailsScreen = ({ location, onBack, onBookNow, onSummarizeReviews, onExploreNearby, summaryResult, isSummaryLoading }) => {
          if (!location) return null;
          
          return (
            <div className="flex flex-col h-full">
              <div className="relative">
                <img src={location.photos[0]} alt={location.name} className="w-full h-56 object-cover" />
                <button onClick={onBack} className="absolute top-4 left-4 bg-white/80 p-2 rounded-full shadow-md backdrop-blur-sm"><icons.ChevronLeft size={24} className="text-gray-800" /></button>
              </div>
              <div className="p-4 flex-grow">
                <h1 className="text-2xl font-bold text-gray-900">{location.name}</h1>
                <p className="text-gray-500 mt-1">{location.address}</p>
                <div className="flex items-center mt-2 space-x-4">
                  <div className="flex items-center text-gray-700"><icons.Star size={16} className="text-yellow-400 fill-yellow-400 mr-1" /> {location.rating} ({location.reviews.length} reviews)</div>
                  <div className="flex items-center text-gray-700"><icons.MapPin size={16} className="text-orange-500 mr-1" /> {location.distance}</div>
                </div>
                <div className="my-6 border-t border-gray-100"></div>
                <div className="space-y-4">
                    <h3 className="font-bold text-gray-800">Reviews</h3>
                    <div className="bg-gray-100 rounded-lg p-4">
                        {isSummaryLoading && <div className="flex items-center justify-center p-4"><icons.Loader2 className="animate-spin text-teal-500" /></div>}
                        {summaryResult && typeof summaryResult === 'string' && (
                            <div className="space-y-2 text-sm text-gray-700 whitespace-pre-wrap">
                                {summaryResult.split('*').map((item, index) => item.trim() && <p key={index} className="flex items-start"><icons.CheckCircle size={16} className="text-green-500 mr-2 mt-0.5 flex-shrink-0" /><span>{item.trim()}</span></p>)}
                            </div>
                        )}
                        {!summaryResult && !isSummaryLoading && (
                            <button onClick={() => onSummarizeReviews(location.reviews)} className="w-full bg-white border border-teal-500 text-teal-600 font-semibold py-2 px-4 rounded-lg shadow-sm hover:bg-teal-50 transition-all flex items-center justify-center">
                                <icons.Sparkles size={16} className="mr-2"/> Summarize with AI
                            </button>
                        )}
                    </div>
                     <h3 className="font-bold text-gray-800 pt-2">Explore Nearby</h3>
                     <button onClick={() => onExploreNearby(location.address)} className="w-full bg-orange-500 text-white font-bold py-2.5 px-4 rounded-lg shadow-md hover:bg-orange-600 transition-all flex items-center justify-center">
                        <icons.Bot size={16} className="mr-2"/> What's interesting around here?
                    </button>
                </div>
              </div>
              <div className="p-4 bg-white border-t border-gray-200 sticky bottom-0">
                <div className="flex justify-between items-center mb-2">
                  <p className="text-gray-600">Price per hour</p>
                  <p className="text-2xl font-bold text-teal-600">₹{location.price}</p>
                </div>
                <button onClick={onBookNow} className="w-full bg-teal-500 text-white font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-teal-600 transition-colors">Book Now</button>
              </div>
            </div>
          );
        };

        const BookingScreen = ({ location, onBack, onConfirm, walletBalance, setWalletBalance }) => {
          const [hours, setHours] = useState(3);
          const [useWallet, setUseWallet] = useState(true);
          const price = location ? location.price * hours : 0;
          const serviceFee = 25;
          const walletDeduction = useWallet ? Math.min(walletBalance, price + serviceFee) : 0;
          const finalPrice = price + serviceFee - walletDeduction;

          const handleConfirm = () => {
            if (useWallet) {
              setWalletBalance(prev => prev - walletDeduction);
            }
            onConfirm();
          };

          return (
            <div className="flex flex-col h-full">
              <div className="p-4 border-b border-gray-200 flex items-center"><button onClick={onBack} className="mr-4"><icons.ChevronLeft size={24} className="text-gray-800" /></button><h1 className="text-xl font-bold text-gray-800">Confirm Booking</h1></div>
              <div className="p-4 flex-grow">
                <div className="bg-white rounded-lg p-4 border border-gray-100"><h2 className="font-bold text-lg">{location.name}</h2><p className="text-sm text-gray-500">{location.address}</p></div>
                <div className="mt-6"><h3 className="font-semibold text-gray-800 mb-2">Duration</h3><div className="flex items-center justify-between p-3 bg-gray-100 rounded-lg"><button onClick={() => setHours(h => Math.max(1, h - 1))} className="w-8 h-8 rounded-full bg-white border border-gray-300 text-lg font-bold text-teal-500">-</button><span className="text-lg font-bold">{hours} hours</span><button onClick={() => setHours(h => h + 1)} className="w-8 h-8 rounded-full bg-white border border-gray-300 text-lg font-bold text-teal-500">+</button></div></div>
                <div className="my-6 border-t border-gray-100"></div>
                <div className="space-y-2">
                    <h3 className="font-semibold text-gray-800 mb-2">Payment Summary</h3>
                    <div className="flex justify-between text-gray-600"><p>Storage ({hours} hours)</p> <p>₹{price}</p></div>
                    <div className="flex justify-between text-gray-600"><p>Service Fee</p> <p>₹{serviceFee}</p></div>
                    <div className="border-t border-dashed my-2"></div>
                    <div className="flex justify-between font-bold text-gray-800"><p>Subtotal</p> <p>₹{price + serviceFee}</p></div>
                    <div className="flex justify-between items-center p-3 bg-green-50 text-green-800 rounded-lg mt-2">
                        <div>
                            <p className="font-semibold">Apply Wallet Balance</p>
                            <p className="text-sm">(Available: ₹{walletBalance})</p>
                        </div>
                        <div className="flex items-center">
                            <span className="font-bold mr-3">- ₹{walletDeduction}</span>
                            <label className="relative inline-flex items-center cursor-pointer"><input type="checkbox" checked={useWallet} onChange={() => setUseWallet(!useWallet)} className="sr-only peer" /><div className="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-500"></div></label>
                        </div>
                    </div>
                </div>
              </div>
               <div className="p-4 bg-white border-t border-gray-200 sticky bottom-0">
                <div className="flex justify-between items-center mb-2"><p className="text-gray-600 text-lg">To Pay</p><p className="text-2xl font-bold text-teal-600">₹{finalPrice}</p></div>
                <button onClick={handleConfirm} className="w-full bg-teal-500 text-white font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-teal-600 transition-colors flex items-center justify-center"><icons.CreditCard size={18} className="mr-2"/> Proceed to Payment</button>
              </div>
            </div>
          );
        };

        const TrackingScreen = () => {
            const trackingStatus = [
                { icon: <icons.Package />, title: "Booking Confirmed", time: "02:45 PM", completed: true },
                { icon: <icons.Truck />, title: "Agent Assigned", time: "02:46 PM", completed: true },
                { icon: <icons.Archive />, title: "Luggage Stored", time: "Pending", completed: false },
                { icon: <icons.CheckCircle />, title: "Delivered", time: "Pending", completed: false },
            ];
            return (
            <div className="flex flex-col h-full bg-gray-50">
                <div className="p-4 bg-white border-b border-gray-200"><h1 className="text-xl font-bold text-gray-800 text-center">Live Tracking</h1></div>
                <div className="p-4 flex-grow">
                    <div className="bg-white rounded-xl shadow-sm p-4 mb-6"><div className="flex justify-between items-center"><div><p className="text-sm text-gray-500">Booking ID</p><p className="font-bold text-gray-800">BD78901</p></div><div className="text-right"><p className="text-sm text-gray-500">Location</p><p className="font-bold text-gray-800">Connaught Place</p></div></div></div>
                    <div className="bg-white rounded-xl shadow-sm p-6">
                        <h2 className="font-bold text-lg mb-6">Status Updates</h2>
                        <div className="relative">
                            <div className="absolute left-5 top-5 bottom-5 w-0.5 bg-gray-200 border-l-2 border-dotted border-gray-300"></div>
                            {trackingStatus.map((status, index) => (
                                <div key={index} className="flex items-start mb-8">
                                    <div className={`z-10 w-10 h-10 rounded-full flex items-center justify-center mr-6 ${status.completed ? 'bg-teal-100 text-teal-500' : 'bg-gray-200 text-gray-400'}`}>{cloneElement(status.icon, { size: 20 })}</div>
                                    <div className="flex-1 pt-2"><p className={`font-bold ${status.completed ? 'text-gray-800' : 'text-gray-500'}`}>{status.title}</p><p className="text-xs text-gray-400 mt-1">{status.time}</p></div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            </div>
        )};

        const WalletScreen = ({ balance, transactions }) => (
            <div className="flex flex-col h-full bg-gray-50">
                <div className="p-4 bg-white border-b border-gray-200"><h1 className="text-xl font-bold text-gray-800 text-center">My Wallet</h1></div>
                <div className="p-4 flex-grow">
                    <div className="bg-teal-600 text-white rounded-xl shadow-lg p-6 mb-6 text-center">
                        <p className="text-sm opacity-80">Current Balance</p>
                        <p className="text-4xl font-bold mt-1">₹{balance}</p>
                        <button className="mt-4 bg-white text-teal-600 font-bold py-2 px-6 rounded-full text-sm flex items-center justify-center mx-auto"><icons.PlusCircle size={16} className="mr-2"/>Add Funds</button>
                    </div>
                    <div className="bg-orange-100 text-orange-800 rounded-xl p-4 mb-6 flex items-center">
                        <icons.Gift size={24} className="mr-3"/>
                        <div><p className="font-bold">Offers & Promos</p><p className="text-sm">You have 2 new offers available!</p></div>
                    </div>
                    <div>
                        <h3 className="font-bold text-gray-800 text-lg mb-2">Transaction History</h3>
                        <div className="space-y-2">
                            {transactions.map(t => (
                                <div key={t.id} className="bg-white p-3 rounded-lg flex justify-between items-center">
                                    <div><p className="font-semibold text-gray-800">{t.type === "Paid" ? `Paid for ${t.details}` : t.type === "Cashback" ? `Cashback on ${t.details}` : `Added via ${t.method}`}</p><p className="text-sm text-gray-500">{t.date}</p></div>
                                    <p className={`font-bold ${t.amount > 0 ? 'text-green-500' : 'text-gray-700'}`}>{t.amount > 0 ? `+₹${t.amount}` : `-₹${Math.abs(t.amount)}`}</p>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            </div>
        );

        const HistoryScreen = ({ bookings }) => (
            <div className="flex flex-col h-full bg-gray-50">
                <div className="p-4 bg-white border-b border-gray-200"><h1 className="text-xl font-bold text-gray-800 text-center">Booking History</h1></div>
                <div className="p-4 flex-grow space-y-4">
                    {bookings.map(b => (
                        <div key={b.id} className="bg-white p-4 rounded-xl shadow-sm">
                            <div className="flex justify-between items-start">
                                <div><p className="font-bold text-gray-800">{b.location}</p><p className="text-sm text-gray-500">{b.date} • {b.id}</p></div>
                                <span className={`text-xs font-semibold px-2 py-1 rounded-full ${b.status === 'Completed' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{b.status}</span>
                            </div>
                            <div className="border-t border-gray-100 my-3"></div>
                            <div className="flex justify-between items-center">
                                <p className="font-bold text-lg text-gray-800">₹{b.price}</p>
                                <button className="bg-gray-100 text-gray-700 font-semibold py-1.5 px-4 rounded-lg text-sm flex items-center"><icons.Repeat size={14} className="mr-1.5"/>Rebook</button>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        );

        const ProfileScreen = () => (
            <div className="flex flex-col h-full bg-gray-50">
                <div className="p-4 bg-white border-b border-gray-200"><h1 className="text-xl font-bold text-gray-800 text-center">Profile</h1></div>
                <div className="p-4 flex-grow">
                    <div className="flex items-center p-4 bg-white rounded-xl shadow-sm mb-6"><img src="https://placehold.co/64x64/e2e8f0/334155?text=S" alt="Profile" className="w-16 h-16 rounded-full mr-4" /><div><h2 className="font-bold text-xl text-gray-800">Siddharth</h2><p className="text-gray-500">+91 12345 67890</p></div></div>
                    <div className="bg-white rounded-xl shadow-sm divide-y divide-gray-100">
                        <ProfileMenuItem icon={<icons.MapPin size={20} className="text-gray-500"/>} text="Saved Locations" />
                        <ProfileMenuItem icon={<icons.LifeBuoy size={20} className="text-gray-500"/>} text="Support & Help Center" />
                        <ProfileMenuItem icon={<icons.User size={20} className="text-gray-500"/>} text="Refer & Earn" />
                    </div>
                </div>
            </div>
        );

        const NotificationsScreen = ({ notifications }) => (
            <div className="flex flex-col h-full bg-gray-50">
                <div className="p-4 bg-white border-b border-gray-200"><h1 className="text-xl font-bold text-gray-800 text-center">Notifications</h1></div>
                <div className="p-4 flex-grow space-y-3">
                    {notifications.map(n => (
                        <div key={n.id} className="bg-white p-4 rounded-xl shadow-sm flex items-start">
                            <div className="w-8 h-8 flex items-center justify-center mr-4 mt-1">{n.icon}</div>
                            <div className="flex-1"><p className="font-bold text-gray-800">{n.title}</p><p className="text-sm text-gray-600">{n.message}</p><p className="text-xs text-gray-400 mt-1">{n.time}</p></div>
                        </div>
                    ))}
                </div>
            </div>
        );

        // --- MODALS ---
        const ItineraryModal = ({ result, isLoading, onClose, onSelectLocation }) => {
            const suggestedLocation = result && result.suggested_storage_id ? mockLocations.find(loc => loc.id === result.suggested_storage_id) : null;
            return (
                <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                    <div className="bg-white rounded-2xl shadow-xl w-full max-w-sm max-h-[90vh] flex flex-col">
                        <div className="p-4 border-b border-gray-200 flex justify-between items-center"><h2 className="font-bold text-lg text-gray-800 flex items-center"><icons.Bot size={20} className="mr-2 text-teal-500"/>AI-Generated Plan</h2><button onClick={onClose} className="text-gray-400 hover:text-gray-600"><icons.X size={24} /></button></div>
                        <div className="p-4 overflow-y-auto">
                            {isLoading && <div className="flex flex-col items-center justify-center p-8"><icons.Loader2 className="animate-spin text-teal-500 text-4xl" /><p className="mt-4 text-gray-600">Building your itinerary...</p></div>}
                            {result && result.error && <p className="text-red-500">{result.error}</p>}
                            {result && !result.error && (
                                <>
                                    {suggestedLocation && (<div className="mb-4"><h3 className="font-semibold text-gray-700 mb-2">Suggested Storage:</h3><LocationCard location={suggestedLocation} onSelect={() => { onSelectLocation(suggestedLocation); onClose(); }} /></div>)}
                                    <div className="border-t border-gray-100 my-4"></div>
                                    <h3 className="font-semibold text-gray-700 mb-3">Your Schedule:</h3>
                                    <div className="space-y-3">
                                        {result.itinerary?.map((item, index) => (
                                            <div key={index} className="flex items-start"><div className="w-20 font-bold text-teal-600 text-sm pt-1">{item.time}</div><div className="flex-1 pl-4 border-l-2 border-teal-200"><p className="font-semibold text-gray-800">{item.activity}</p><p className="text-sm text-gray-500">{item.description}</p></div></div>
                                        ))}
                                    </div>
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const ExploreNearbyModal = ({ result, isLoading, onClose }) => {
            const iconMap = { Cafe: <icons.Coffee/>, Landmark: <icons.Building/>, Activity: <icons.Camera/>, Shopping: <icons.Gift/> };
            return (
                <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                    <div className="bg-white rounded-2xl shadow-xl w-full max-w-sm max-h-[90vh] flex flex-col">
                        <div className="p-4 border-b border-gray-200 flex justify-between items-center"><h2 className="font-bold text-lg text-gray-800 flex items-center"><icons.Bot size={20} className="mr-2 text-orange-500"/>Explore Nearby</h2><button onClick={onClose} className="text-gray-400 hover:text-gray-600"><icons.X size={24} /></button></div>
                        <div className="p-4 overflow-y-auto">
                            {isLoading && <div className="flex flex-col items-center justify-center p-8"><icons.Loader2 className="animate-spin text-orange-500 text-4xl" /><p className="mt-4 text-gray-600">Finding local gems...</p></div>}
                            {result && result.error && <p className="text-red-500">{result.error}</p>}
                            {result && !result.error && Array.isArray(result) && (
                                <div className="space-y-4">
                                    {result.map((item, index) => (
                                        <div key={index} className="flex items-start bg-gray-50 p-3 rounded-lg">
                                            <div className="w-10 h-10 rounded-lg bg-orange-100 text-orange-500 flex items-center justify-center mr-3">{iconMap[item.category] || <icons.Star />}</div>
                                            <div><p className="font-semibold text-gray-800">{item.name}</p><p className="text-sm text-gray-600">{item.description}</p></div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const RateExperienceModal = ({ bookingId, onClose }) => {
            const [rating, setRating] = useState(0);
            return (
                <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                    <div className="bg-white rounded-2xl shadow-xl w-full max-w-sm">
                        <div className="p-4 text-center">
                            <h2 className="font-bold text-lg text-gray-800">Rate Your Experience</h2>
                            <p className="text-sm text-gray-500 mb-4">Booking ID: {bookingId}</p>
                            <div className="flex justify-center space-x-2 my-4">
                                {[1, 2, 3, 4, 5].map(star => <icons.Star key={star} size={36} onClick={() => setRating(star)} className={`cursor-pointer transition-colors ${rating >= star ? 'text-yellow-400 fill-yellow-400' : 'text-gray-300'}`} />)}
                            </div>
                            <textarea placeholder="Tell us more..." className="w-full bg-gray-100 border border-gray-200 rounded-lg p-2 text-sm focus:ring-2 focus:ring-teal-200 outline-none transition" rows="3"></textarea>
                            <button onClick={onClose} className="w-full mt-4 bg-teal-500 text-white font-bold py-2.5 px-4 rounded-lg shadow-md hover:bg-teal-600 transition-all">Submit Feedback</button>
                            <button onClick={onClose} className="w-full mt-2 text-sm text-gray-500">Maybe later</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- REUSABLE COMPONENTS ---
        const LocationCard = ({ location, onSelect }) => (
          <div onClick={onSelect} className="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow cursor-pointer border border-gray-100">
            <div className="flex">
              <img className="w-1/3 h-auto object-cover" src={location.photos[0]} alt={location.name} onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/200x200/e2e8f0/334155?text=Image'; }} />
              <div className="p-4 flex-1">
                <div className="flex justify-between items-start"><h3 className="font-bold text-gray-900">{location.name}</h3><div className="flex items-center bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded-full"><icons.Star size={12} className="mr-1 fill-green-800" /> {location.rating}</div></div>
                <p className="text-gray-500 text-sm mt-1">{location.address}</p>
                <div className="flex justify-between items-center mt-3"><p className="text-sm text-gray-600">{location.distance}</p><p className="font-bold text-teal-600">₹{location.price}<span className="font-normal text-gray-500 text-xs">/hr</span></p></div>
              </div>
            </div>
          </div>
        );

        const BottomNavBar = ({ activePage, navigateTo }) => {
          const navItems = [
            { name: 'home', icon: <icons.Home />, label: 'Home' },
            { name: 'history', icon: <icons.History />, label: 'Bookings' },
            { name: 'wallet', icon: <icons.Wallet />, label: 'Wallet' },
            { name: 'profile', icon: <icons.User />, label: 'Profile' },
          ];
          return (
            <div className="w-full max-w-sm bg-white border-t border-gray-200 flex justify-around sticky bottom-0 shadow-t-lg">
              {navItems.map(item => (
                <button key={item.name} onClick={() => navigateTo(item.name)} className={`flex flex-col items-center justify-center p-3 text-sm transition-colors duration-200 w-full ${activePage === item.name ? 'text-teal-500' : 'text-gray-400 hover:text-teal-400'}`}>
                  {cloneElement(item.icon, { size: 24, strokeWidth: activePage === item.name ? 2.5 : 2 })}
                  <span className="mt-1 text-xs font-medium">{item.label}</span>
                </button>
              ))}
            </div>
          );
        };

        const ProfileMenuItem = ({ icon, text }) => (
            <button className="w-full flex items-center p-4 text-left text-gray-700 hover:bg-gray-50 transition-colors">
                {icon}<span className="ml-4 flex-1 font-semibold">{text}</span><icons.ChevronRight size={20} className="text-gray-400" />
            </button>
        );

        // --- MOUNTING THE APP ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
